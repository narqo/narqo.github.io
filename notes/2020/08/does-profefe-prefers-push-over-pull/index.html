<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=color-scheme content="light dark">
<meta http-equiv=x-ua-compatible content="ie=edge">
<title>Does profefe prefers "push" over "pull"? - Vladimir Varankin</title>
<link rel=canonical href=https://vladimir.varank.in/notes/2020/08/does-profefe-prefers-push-over-pull/>
<meta property="og:title" content="Does profefe prefers &#34;push&#34; over &#34;pull&#34;?">
<meta property="og:description" content="profefe-collector, the main component of profefe, a system for continuous profiling, receives profiling data from an application and persists the data in the collector's storage. But why waiting for the data to be pushed instead of pulling it directly from the application?">
<meta property="og:type" content="article">
<meta property="og:url" content="https://vladimir.varank.in/notes/2020/08/does-profefe-prefers-push-over-pull/"><meta property="article:section" content="notes">
<meta property="article:published_time" content="2020-08-21T00:00:00+00:00">
<meta property="article:modified_time" content="2020-08-21T00:00:00+00:00">
<style>:root{--background-color:#fff;--text-color:rgb(19, 19, 19);--text-underline-color:rgba(19, 19, 19, 0.7);--header-color:#111;--hr-color:rgb(143, 150, 163);--link-color:rgb(0, 16, 161);--link-underline-color:rgba(0, 16, 161, 0.3);--link-active-color:rgb(231, 19, 19);--link-active-underline-color:rgba(231, 19, 19, 0.7);--tag-color:rgb(85, 63, 63);--tag-underline-color:rgba(85, 63, 63, 0.5)}html{font-size:16px;height:100%;margin:0;padding:0}body{background:var(--background-color);color:var(--text-color);display:grid;grid-template-rows:auto 1fr auto;font-family:Charter,Georgia,serif;font-size:1.1rem;line-height:1.3;margin:5px 1%;margin:5px max(7px,1%);margin:5px clamp(7px,1.5vw,14px);min-height:calc(100vh - 10px)}h1,h2,h3,h4,h5,h6{color:var(--header-color);font-family:Athelas,Georgia,serif;line-height:1;margin:1.5em 0 .7em}h1{font-size:40px;margin:.5em 0 .2em}a{color:#0010a1;color:var(--link-color);text-decoration-color:var(--link-underline-color);text-decoration-thickness:.04em;text-underline-offset:.1em}a:hover,a:active{color:#be0000;color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}ul,ol{box-sizing:border-box;max-width:760px;padding:0}ol{padding-left:1.2em}ul>li{list-style:none;margin:.5em 0}figure{margin:0;margin-block-start:1em;margin-block-end:1em;padding:0}pre{line-height:1.1;margin:2em 1em}code{font-family:sf mono,Menlo,Consolas,monospace;font-size:16px}pre code{font-size:15px;tab-size:4}hr{color:var(--hr-color);border:none;border-bottom:1px solid;margin:.5em 0;width:76%}.site-nav{display:flex;flex-wrap:wrap;letter-spacing:.3em;padding-bottom:16px}.site-nav a,.site-nav span{margin-right:.6em;letter-spacing:0}.site-nav-item-active{color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}.site-content{font-size:19px;max-width:940px}.site-content img{max-width:100%;max-width:calc(100vw - 15px)}.site-content pre{max-width:calc(100vw - 2em);overflow-x:visible}.site-footer{font-size:14px;margin:50px 0 0}.site-footer a{color:var(--text-color);text-decoration-color:inherit;text-decoration-color:var(--text-underline-color)}.main-head{display:flex;align-items:baseline;gap:8px}.main-head-meta{font-size:16px;margin:0;padding:0}.main-head-meta a{color:var(--text-color);text-decoration-color:inherit;text-decoration-color:var(--text-underline-color);margin:0 5px 0 0}.main-head-meta a:hover,.main-head-meta a:active{color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}.article{margin:0 0 50px}.article:last-child{margin-bottom:0}.section-head{font-size:28px}.section-head h1,.section-head h2{font-size:1em;margin-top:1em}.section-head h2{margin-bottom:0}.snippet{margin:0 0 40px}.snippet:last-of-type{margin:0}.snippet p{margin:0 0 .3em}.snippet-head h2{font-size:21px;margin:1em 0 .2em}.meta{font-size:14px;line-height:1;padding:5px 0 0}.tag{color:var(--tag-color);text-decoration-color:var(--tag-underline-color);margin:0 0 0 7px;text-transform:lowercase}.meta-topics-list{line-height:1.4;padding:34px 0 0}.meta-topics-list .tag{display:inline-block;margin:0 1ex 0 0}.glitch:before{background:var(--background-color);position:absolute;content:attr(data-text);clip:rect(0,900px,0,0);animation:glitch-anim 2s infinite linear alternate-reverse;margin-left:-5px;text-shadow:1px 0 red}@media(prefers-reduced-motion){.glitch:before{display:none}}@keyframes glitch-anim{0%{clip:rect(3px,9999px,93px,0)}5%{clip:rect(53px,9999px,78px,0)}10%{clip:rect(10px,9999px,75px,0)}15%{clip:rect(32px,9999px,40px,0)}20%{clip:rect(65px,9999px,62px,0)}25%{clip:rect(31px,9999px,14px,0)}30%{clip:rect(94px,9999px,87px,0)}35%{clip:rect(81px,9999px,41px,0)}40%{clip:rect(45px,9999px,50px,0)}45%{clip:rect(82px,9999px,41px,0)}50%{clip:rect(71px,9999px,3px,0)}55%{clip:rect(75px,9999px,60px,0)}60%{clip:rect(20px,9999px,49px,0)}65%{clip:rect(67px,9999px,92px,0)}70%{clip:rect(47px,9999px,55px,0)}75%{clip:rect(63px,9999px,90px,0)}80%{clip:rect(70px,9999px,92px,0)}85%{clip:rect(41px,9999px,60px,0)}90%{clip:rect(56px,9999px,79px,0)}95%{clip:rect(21px,9999px,68px,0)}100%{clip:rect(15px,9999px,72px,0)}}</style>
</head>
<body>
<nav class=site-nav>
<a href=/ class=glitch data-text="Vladimir Varankin">Vladimir Varankin</a>
<a href=/notes/ class=site-nav-item-active>Notes</a>
<a href=/publications/>Publications</a>
<span> · </span>
<a href=https://github.com/narqo>GitHub</a>
<a href=https://twitter.com/tvii>Twitter</a>
<a href=https://t.me/varankinv>Telegram</a>
<a href=https://keybase.io/varankinv>Keybase</a>
</nav>
<main class=site-content>
<header class=section-head>
<h1>Does profefe prefers "push" over "pull"?</h1>
</header>
<p>The main component of <a href=https://github.com/profefe/profefe>profefe, a system for continuous profiling</a>, is <em>profefe-collector</em> — a service that receives profiling data, taken from an application and persists the data in collector’s storage (<a href=https://github.com/profefe/profefe/blob/master/DESIGN.md>design document</a> describes it in more details). Receiving data from an external source (for example, <em>profefe-agent</em>), indicates that profefe, as an observability system, prefers &ldquo;push&rdquo; model. Why not &ldquo;pulling&rdquo; the profiles directly from the application?</p>
<p>Both push and pull models have their benefits and drawbacks.</p>
<p>A collector that pulls profiling data from running applications could simplify integration into existing infrastructure because there would be no need in making changes in the applications that already exposed pprof HTTP endpoint. Making sure that every application integrated and configured profefe-agent would be a challenging job in a large organisation.</p>
<p>On the other hand, pull model requires pprof servers to be exposed and available for the collector, so it could fetch (<em>pull</em>) profiling data. That can also be challenging in the deployments, where applications are collocated on the bare-metal machines. Every application (application&rsquo;s instance) would have to communicate a unique TCP port for its pprof server.</p>
<p>To work as a pull-system, the collector must be able to discover the pprof servers, thus it requires a mechanism for service discovery (SD), to be usable at scale. Unfortunately, there isn&rsquo;t a universal SD protocol or a provider, an observability system could be built upon.</p>
<p>Prometheus, the best example of an open-source system, which uses pull model for data collection, have to support several different SD systems in their code base. At some point they <a href=https://prometheus.io/blog/2018/07/05/implementing-custom-sd/>ended up introducing their own general protocol</a>, that expects a &ldquo;middle-man-service&rdquo;, which translates the data from a SD system into a list of Prometheus targets (<em>Update, <a href="https://www.reddit.com/r/golang/comments/idwi4d/does_profefe_a_system_for_continuous_profiling/g2by237/?utm_source=reddit&utm_medium=web2x&context=3">this comment from u/bbrazil</a> does a better job explaining the state of SD in Prometheus</em>). There is no clear way for an open-source system to be both flexible and don&rsquo;t end up being a pile of &ldquo;plugins&rdquo;, that no one is willing to maintain or break.</p>
<p>From the start of profefe project, several years ago, I had the idea that translating push into pull would be easier for an end-user. That is if a small deployment already exposes a pprof server, writing an external job that pulls the profiles from the applications, annotates them with meta-data, and pushes the data into the collector, can be as easy as spawning a cronjob in a sidecar. <a href=https://github.com/profefe/kube-profefe>kube-profefe</a> solves that nicely for deployments running in Kubernetes. At some point, I hoped to come up with something similar for Nomad+Consul if the experiments ended successfully.</p>
<p>Translating pull into push is a similarly possible but because profefe didn’t have to support any SD mechanisms from the start, that simplified the overall code base and allowed us to focus on the collector and the <a href=https://github.com/profefe/profefe#http-api>API for profiles quering</a>.</p>
<p>profefe-collector does uses push model. But one can deploy profefe so it reflected the use cases your organisation has.</p>
<p>Do you use continuous profiling? Let me know about your experience. Share your thoughts <a href=https://twitter.com/tvii/status/1296796503781122049>on Twitter</a> or <a href=https://www.reddit.com/r/golang/comments/idwi4d/does_profefe_a_system_for_continuous_profiling/>discuss on r/golang</a>.</p>
<footer class=meta>
<time datetime=2020-08-21T12:00:00Z>August 21, 2020</time><a class=tag href=/notes/profefe/>profefe</a><a class=tag href=/notes/continuous-profiling/>continuous profiling</a><a class=tag href=/notes/go/>Go</a><a class=tag href=/notes/pprof/>pprof</a>
</footer>
<section class="meta meta-topics-list">
<header class=meta-topics-list-title><h3>All topics</h3></header><a class=tag href=https://vladimir.varank.in/notes/aarch64/>aarch64</a><a class=tag href=https://vladimir.varank.in/notes/arduino/>arduino</a><a class=tag href=https://vladimir.varank.in/notes/arm64/>arm64</a><a class=tag href=https://vladimir.varank.in/notes/askme/>askme</a><a class=tag href=https://vladimir.varank.in/notes/berlin/>berlin</a><a class=tag href=https://vladimir.varank.in/notes/buildkit/>buildkit</a><a class=tag href=https://vladimir.varank.in/notes/cgo/>cgo</a><a class=tag href=https://vladimir.varank.in/notes/coffee/>coffee</a><a class=tag href=https://vladimir.varank.in/notes/continuous-profiling/>continuous profiling</a><a class=tag href=https://vladimir.varank.in/notes/covid-19/>COVID-19</a><a class=tag href=https://vladimir.varank.in/notes/design/>design</a><a class=tag href=https://vladimir.varank.in/notes/docker/>docker</a><a class=tag href=https://vladimir.varank.in/notes/e-paper/>e-paper</a><a class=tag href=https://vladimir.varank.in/notes/esp8266/>esp8266</a><a class=tag href=https://vladimir.varank.in/notes/firefox/>firefox</a><a class=tag href=https://vladimir.varank.in/notes/github-actions/>github actions</a><a class=tag href=https://vladimir.varank.in/notes/go/>Go</a><a class=tag href=https://vladimir.varank.in/notes/go-time-fm/>go time fm</a><a class=tag href=https://vladimir.varank.in/notes/homelab/>homelab</a><a class=tag href=https://vladimir.varank.in/notes/ipv6/>IPv6</a><a class=tag href=https://vladimir.varank.in/notes/k3s/>k3s</a><a class=tag href=https://vladimir.varank.in/notes/kubernetes/>kubernetes</a><a class=tag href=https://vladimir.varank.in/notes/macos/>macos</a><a class=tag href=https://vladimir.varank.in/notes/mdns/>mDNS</a><a class=tag href=https://vladimir.varank.in/notes/ndppd/>ndppd</a><a class=tag href=https://vladimir.varank.in/notes/objective-c/>objective-c</a><a class=tag href=https://vladimir.varank.in/notes/postgresql/>PostgreSQL</a><a class=tag href=https://vladimir.varank.in/notes/pprof/>pprof</a><a class=tag href=https://vladimir.varank.in/notes/profefe/>profefe</a><a class=tag href=https://vladimir.varank.in/notes/random/>random</a><a class=tag href=https://vladimir.varank.in/notes/raspberry-pi/>raspberry pi</a><a class=tag href=https://vladimir.varank.in/notes/travis-ci/>travis ci</a><a class=tag href=https://vladimir.varank.in/notes/vs-code/>vs code</a><a class=tag href=https://vladimir.varank.in/notes/waveshare/>waveshare</a><a class=tag href=https://vladimir.varank.in/notes/%C2%B5-benchmarks/>µ-benchmarks</a></section>
</main>
<footer class=site-footer>© 2019&#8230;2022 #SocialDistancing<br><a href=mailto:vladimir@varank.in>vladimir@varank.in</a></footer>
<img src=https://c.varank.in/hello/*https://vladimir.varank.in/notes/2020/08/does-profefe-prefers-push-over-pull/ style=position:absolute;left:-9999px decoding=async alt>
</body>
</html>