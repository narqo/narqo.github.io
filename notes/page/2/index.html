<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/x-icon href=/favicon.ico><title>Notes - Vladimir Varankin</title><link rel=canonical href=https://vladimir.varank.in/notes/><link rel=alternate type=application/rss+xml href=https://vladimir.varank.in/notes/index.xml title="Notes from Vladimir Varankin"><meta property="og:url" content="https://vladimir.varank.in/notes/"><meta property="og:site_name" content="Vladimir Varankin"><meta property="og:title" content="Notes"><meta property="og:locale" content="en"><meta property="og:type" content="website"><style>:root{--background-color:#fff;--text-color:rgb(19, 19, 19);--text-underline-color:rgba(19, 19, 19, 0.5);--header-color:#111;--hr-color:rgb(143, 150, 163);--link-color:rgb(0, 16, 161);--link-underline-color:rgba(0, 16, 161, 0.3);--link-active-color:rgb(231, 19, 19);--link-active-underline-color:rgba(231, 19, 19, 0.7);--tag-color:rgb(85, 63, 63);--tag-underline-color:rgba(85, 63, 63, 0.5)}html{font-size:16px;height:100%;margin:0;padding:0}body{background:var(--background-color);color:var(--text-color);display:grid;grid-template-rows:auto 1fr auto;font-family:Charter,Georgia,serif;font-size:1.1rem;line-height:1.3;margin:5px 2%;margin:5px clamp(7px,1.5vw,25px);min-height:calc(100vh - 10px)}h1,h2,h3,h4,h5,h6{color:var(--header-color);font-family:Athelas,Georgia,serif;line-height:1.1;margin:1.5em 0 .7em}h1{font-size:40px;margin:.5em 0 .2em}a{color:#0010a1;color:var(--link-color);text-decoration-color:var(--link-underline-color);text-decoration-thickness:.04em;text-underline-offset:.1em}a:hover,a:active{color:#be0000;color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}ul,ol{box-sizing:border-box;max-width:760px;padding:0}ol{padding-left:1.2em}ul>li{list-style:none;margin:.5em 0}figure{margin:0;margin-block-start:1em;margin-block-end:1em;padding:0}figcaption{font-size:16px;font-style:italic}pre{line-height:1.1}code{font-family:sf mono,Menlo,Consolas,monospace;font-size:16px}pre code{font-size:14px;tab-size:2}@media screen and (min-width:900px){pre{margin:2em 1em}pre code{font-size:15px;tab-size:4}}hr{color:var(--hr-color);border:none;margin:.5em 0;width:90%}hr::after{content:'¶';display:block;font-size:14px;text-align:center}body{background-image:url(/avatar-bg-min.svg);background-position:-30px -14px;background-repeat:no-repeat;background-size:110px}.site-index{background-image:none}.site-avatar{border:2px solid #fff;border-radius:50%;width:56px;height:56px;position:absolute;margin-top:-11px;margin-left:-68px}.site-nav{display:flex;flex-wrap:wrap;letter-spacing:.3em;padding-bottom:36px;margin-top:10px;margin-left:60px}.site-nav a,.site-nav span{margin-right:.6em;letter-spacing:0}.site-nav-item-active{color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}@media screen and (max-width:600px){.site-avatar{width:48px;height:48px;margin-left:-64px}.site-nav{padding-bottom:5px}}.site-content{font-size:19px;max-width:940px}.site-content img{max-width:100%;max-width:calc(100vw - 15px)}.site-content pre{max-width:calc(100vw - 1em);overflow:visible;overflow-x:scroll}@media screen and (min-width:900px){.site-content pre{max-width:calc(100vw - 4em);overflow-x:visible}}.site-footer{font-size:14px;margin:50px 0 0}.site-footer a{color:var(--text-color);text-decoration-color:inherit;text-decoration-color:var(--text-underline-color)}.main-head{display:flex;align-items:baseline;gap:8px;margin-bottom:-.7em}.main-head-meta{font-size:16px;margin:0;padding:0}.main-head-meta a{color:var(--text-color);text-decoration-color:inherit;text-decoration-color:var(--text-underline-color);margin:0 5px 0 0}.main-head-meta a:hover,.main-head-meta a:active{color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}.article{margin:0 0 50px}.article:last-child{margin-bottom:0}.section-head{font-size:28px}.section-head h1,.section-head h2{font-size:1em;margin-top:1em}.section-head h2{margin-bottom:0}.snippet{margin:0 0 40px}.snippet:last-of-type{margin:0}.snippet p{margin:0 0 .3em}.snippet-head h2{font-size:21px;margin:1em 0 .2em}.meta{font-size:14px;line-height:1;padding:5px 0 0}.tag{color:var(--tag-color);text-decoration-color:var(--tag-underline-color);margin:0 0 0 7px;text-transform:lowercase}.meta-topics-list{line-height:1.4;padding:34px 0 0}.meta-topics-list .tag{display:inline-block;margin:0 1ex 0 0}.pagination{display:flex;flex-wrap:nowrap}.page-item{display:inline-block;line-height:32px;margin-right:1em}.glitch:before{background:var(--background-color);position:absolute;content:attr(data-text);clip:rect(0,900px,0,0);animation:glitch-anim 2s infinite linear alternate-reverse;margin-left:-5px;text-shadow:1px 0 red}@media(prefers-reduced-motion){.glitch:before{display:none}}@keyframes glitch-anim{0%{clip:rect(3px,9999px,93px,0)}5%{clip:rect(53px,9999px,78px,0)}10%{clip:rect(10px,9999px,75px,0)}15%{clip:rect(32px,9999px,40px,0)}20%{clip:rect(65px,9999px,62px,0)}25%{clip:rect(31px,9999px,14px,0)}30%{clip:rect(94px,9999px,87px,0)}35%{clip:rect(81px,9999px,41px,0)}40%{clip:rect(45px,9999px,50px,0)}45%{clip:rect(82px,9999px,41px,0)}50%{clip:rect(71px,9999px,3px,0)}55%{clip:rect(75px,9999px,60px,0)}60%{clip:rect(20px,9999px,49px,0)}65%{clip:rect(67px,9999px,92px,0)}70%{clip:rect(47px,9999px,55px,0)}75%{clip:rect(63px,9999px,90px,0)}80%{clip:rect(70px,9999px,92px,0)}85%{clip:rect(41px,9999px,60px,0)}90%{clip:rect(56px,9999px,79px,0)}95%{clip:rect(21px,9999px,68px,0)}100%{clip:rect(15px,9999px,72px,0)}}</style></head><body><nav class=site-nav><a href=/ class=glitch data-text="Vladimir Varankin"><img class=site-avatar src=/v.jpg>
Vladimir Varankin
</a><a href=/notes/ class=site-nav-item-active>Notes</a>
<a href=/publications/>Publications</a>
<span>· </span><a href=https://github.com/narqo>GitHub</a>
<a href=https://bsky.app/profile/vladimir.varank.in>Bluesky</a>
<a href=https://t.me/varankinv>Telegram</a></nav><main class=site-content><header class=main-head><h1>Notes</h1>/<menu class=main-head-meta><a href=/notes/berlin/>Berlin</a>
<a href=/notes/go/>Go</a>
<a href=/notes/homelab/>Homelab</a>
<a href=/notes/kubernetes/>Kubernetes</a>
<a href=/notes/all/>Everything</a></menu></header><article class=article data-weight=0 data-word-count=200 data-reading-time=1><header class=section-head><h2><a href=/notes/2022/06/bookmarks-4/>Bookmarks (issue 4)</a></h2></header><p><a href=https://tip.golang.org/doc/go1.19>Go 1.19beta1</a>. As usual, lots of good improvements in the language&rsquo;s runtime and the compiler, with one particularly interesting addition being the new &ldquo;knob&rdquo; <code>runtime/debug.SetMemoryLimit</code>.</p><p><a href=https://www.grammarly.com/blog/gender-neutral-language/>How to use gender-neutral language at work and in life</a> (Grammarly). &ldquo;Luckily, the English language is relatively gender-neutral in many respects&rdquo; [at least, when compared to Russian and German languages].</p><p><a href=https://developer.apple.com/videos/play/wwdc2022/10092>Meet passkeys</a> (Apple) and <a href="https://www.youtube.com/watch?v=mjHIt9lDBgA">Everything you want to know about WebAuthn</a> (OktaDev). As you can guess, I&rsquo;m very excited with Apple stepping onto the path to a passwordless future, while betting on WebAuthn standard.</p><p><a href=https://developer.apple.com/videos/play/wwdc2022/10077/>Replace CAPTCHAs with Private Access Tokens</a> (Apple),
<a href=https://www.fastly.com/blog/private-access-tokens-stepping-into-the-privacy-respecting-captcha-less>Private Access Tokens: stepping into the privacy-respecting, CAPTCHA-less future we were promised</a> (Fastly),
<a href=https://blog.cloudflare.com/eliminating-captchas-on-iphones-and-macs-using-new-standard/>Private Access Tokens: eliminating CAPTCHAs on iPhones and Macs with open standards</a> (Cloudflare).</p><footer class=meta><time datetime=2022-06-30T12:00:00Z>June 30, 2022</time><a class=tag href=/notes/bookmarks/>Bookmarks</a><a class=tag href=/notes/apple/>Apple</a><a class=tag href=/notes/passkeys/>Passkeys</a><a class=tag href=/notes/go/>Go</a><a class=tag href=/notes/english/>English</a><a class=tag href=/notes/random/>Random</a></footer></article><article class=article data-weight=0 data-word-count=200 data-reading-time=1><header class=section-head><h2><a href=/notes/2022/05/bookmarks-3/>Bookmarks (issue 3)</a></h2></header><p><a href=https://exercism.org/tracks/rust>Rust tracks on Exercism</a>. More than 100 coding exercises to learn <a href=https://www.rust-lang.org/>Rust</a> through practice.</p><p><a href=https://www.postgresql.org/about/news/postgresql-anonymizer-10-privacy-by-design-for-postgres-2452/>PostgreSQL Anonymizer 1.0</a>. A PostgreSQL extension for declarative data masking (<a href=https://postgresql-anonymizer.readthedocs.io/en/latest/>docs and examples</a>).</p><p><a href=https://postgrespro.com/blog/pgsql/5969493>Queries in PostgreSQL: 4. Index scan</a> (Postgres Pro). An in-depth overview of how PostgreSQL decides if it will use an index.
One particular thing I had no idea about before I read the article was that &ldquo;The Index Scan cost is highly dependent on the <em>correlation</em> between the physical order of the tuples on disk and the order in which the access method returns the IDs&rdquo;. That explains several cases from my own experience, where postgres kept using &ldquo;unexpected&rdquo; sequential scans, after we added &ldquo;another index&rdquo; to the database.</p><p><a href=https://www.micahlerner.com/2022/04/24/monarch-googles-planet-scale-in-memory-time-series-database.html>Monarch: Google’s planet-scale in-memory time series database</a> (<a href=https://twitter.com/micahlerner>Micah Lerner</a>). A review of the paper (<a href=https://storage.googleapis.com/pub-tools-public-publication-data/pdf/d84ab6c93881af998de877d0070a706de7bec6d8.pdf>PDF</a>), which describes the latest iteration of Google&rsquo;s in-house metrics system.</p><p><a href=https://google.aip.dev/>Google’s API Improvement Proposals (AIP)</a>. A collection of design documents that summarize Google&rsquo;s API design decisions.</p><footer class=meta><time datetime=2022-05-31T12:00:00Z>May 31, 2022</time><a class=tag href=/notes/bookmarks/>Bookmarks</a><a class=tag href=/notes/google/>Google</a><a class=tag href=/notes/postgresql/>Postgresql</a><a class=tag href=/notes/rust/>Rust</a></footer></article><article class=article data-weight=0 data-word-count=800 data-reading-time=4><header class=section-head><h2><a href=/notes/2022/05/a-real-life-use-case-for-generics-in-go-api-for-client-side-pagination/>A real life use-case for generics in Go: API for client-side pagination</a></h2></header><p>Let&rsquo;s say we have a RESTful API for a general ledger, with the endpoints, that return a paginated collection of resources:</p><ol><li><code>GET /accounts</code>, retrieves a list of accounts, filtered and sorted by some query parameters;</li><li><code>GET /accounts/:uuid/transactions</code>, retrieves a list of transactions for account;</li><li><code>GET /postings</code>, retrieves a list of <a href=https://en.wikipedia.org/wiki/Double-entry_bookkeeping>postings</a> stored in the ledger.</li></ol><p><a href=/notes/2022/05/a-real-life-use-case-for-generics-in-go-api-for-client-side-pagination/>No, this one isn't about data-structures...</a></p><footer class=meta><time datetime=2022-05-17T12:00:00Z>May 17, 2022</time><a class=tag href=/notes/go/>Go</a></footer></article><article class=article data-weight=0 data-word-count=300 data-reading-time=2><header class=section-head><h2><a href=/notes/2022/04/bookmarks-2/>Bookmarks (issue 2)</a></h2></header><p><a href=https://en.wikipedia.org/wiki/Digital_object_identifier>Digital object identifier (DOI)</a> (Wikipedia). A DOI is a persistent identifier or handle used to identify various objects uniquely. It aims to be &ldquo;resolvable&rdquo;, usually to some form of access to the information object to which the DOI refers. This is achieved by binding the DOI to metadata about the object, such as a URL. Thus, by being actionable and interoperable, a DOI differs from identifiers such as ISBNs, which aim only to identify their referents uniquely.</p><p><a href=https://principledgraphql.com/operations>Operations principles: securely deploying the graph to production at scale</a> (Principled GraphQL). Lots of things listed there apply to any sort of APIs — not only to GraphQL.</p><p><a href="https://www.youtube.com/watch?v=Dvb7ooaFJaU">Songs your English teacher will NEVER teach!</a> (Learn English with Papa Teach Me). Vocabulary from &ldquo;Savage&rdquo;, &ldquo;WAP&rdquo;, and &ldquo;34+35&rdquo;. This video is <em>definitely</em> not for kids!</p><p><a href=https://www.grammarly.com/blog/phrases-spring-clean/>8 phrases to spring-clean from your emails</a> (Grammarly).</p><p><a href=https://www.acquired.fm/episodes/platforms-and-power-with-hamilton-helmer-and-chenyi-shi>Platforms and Power</a> (Acquired). &ldquo;7 Powers&rdquo; author Hamilton Helmer and Chenyi Shi (Strategy Capital), joined Acquired Podcast to discuss platform businesses, and how the &ldquo;Power&rdquo; framework applies to them.</p><p><a href=https://medium.com/@matryer/halfthings-a8c72365617c>Halfthings</a> (<a href=https://twitter.com/matryer/>Mat Ryer</a>).
Building something for the users to play with, to touch, to feel, to break, makes all the difference and moves the conversations away from the meta.
Doing &ldquo;one thing&rdquo; or &ldquo;building an MVP&rdquo; can easily pull you into a &ldquo;too much&rdquo; for a validation phase. Build a &ldquo;<em>halfthing</em>&rdquo; instead.</p><footer class=meta><time datetime=2022-04-30T12:00:00Z>April 30, 2022</time><a class=tag href=/notes/bookmarks/>Bookmarks</a><a class=tag href=/notes/graphql/>Graphql</a><a class=tag href=/notes/english/>English</a><a class=tag href=/notes/random/>Random</a></footer></article><article class=article data-weight=0 data-word-count=200 data-reading-time=1><header class=section-head><h2><a href=/notes/2022/03/bookmarks-1/>Bookmarks (issue 1)</a></h2></header><p><a href=https://planetscale.com/blog/generics-can-make-your-go-code-slower>Generics can make your Go code slower</a> (PlanetScale):</p><ol><li>boxing vs monomorphization vs partial monomorphization (&ldquo;GCShape stenciling with Dictionaries&rdquo;)</li><li>interface inlining doesn&rsquo;t work well with the 1.18&rsquo;s compiler</li><li>generics work well for byte sequences (<code>string | []byte</code>)</li><li>in simple cases, generics can be useful for function callbacks.</li></ol><p><a href=https://engineering.fb.com/2022/03/30/security/de-identified-authentication-at-scale/>How Meta enables de-identified authentication at scale</a>. The rational, the use-cases, and a high-level architecture of Meta&rsquo;s Anonymous Credential Service (ACS).</p><p><a href=https://aws.amazon.com/blogs/database/hidden-dangers-of-duplicate-key-violations-in-postgresql-and-how-to-avoid-them/>Hidden dangers of duplicate key violations in PostgreSQL</a> (AWS). <code>INSERT … ON CONFLICT</code> has additional benefits, if compared to relying on PostgreSQL&rsquo;s &ldquo;duplicate key violation&rdquo; error:</p><ol><li>no additional space needed for dead tuples</li><li>less autovacuum required</li><li>transaction IDs aren&rsquo;t used for nothing, preventing (postponing) the potential trx-id wraparound.</li></ol><p><a href=https://aws.amazon.com/blogs/containers/diving-into-iam-roles-for-service-accounts/>Diving into AWS IAM Roles for (Kubernetes) Service Accounts (IRSA)</a>.</p><footer class=meta><time datetime=2022-03-31T12:00:00Z>March 31, 2022</time><a class=tag href=/notes/bookmarks/>Bookmarks</a><a class=tag href=/notes/go/>Go</a><a class=tag href=/notes/postgresql/>Postgresql</a><a class=tag href=/notes/aws/>Aws</a><a class=tag href=/notes/kubernetes/>Kubernetes</a></footer></article><article class=article data-weight=0 data-word-count=300 data-reading-time=2><header class=section-head><h2><a href=/notes/2022/02/go-talks-i-keep-coming-back-to/>Go talks I keep coming back to</a></h2></header><p>I have a personal list of &ldquo;top conference talks&rdquo; that I keep referring back to, even after years of working with Go:</p><ul><li><strong><a href="https://www.youtube.com/watch?v=3RkRpS2UV80">Go profiling from bottom up</a></strong>, <a href=https://github.com/felixge>Felix Geisendörfer</a>, GoLab 2021. Felix explains what&rsquo;s under the hood of Go&rsquo;s pprof.</li><li><strong><a href="https://www.youtube.com/watch?v=S_1YfTfuWmo">Evolving the Go Memory Manager&rsquo;s RAM and CPU Efficiency</a></strong>, Michael Knyszek, GopherCon 2020</li><li><strong><a href="https://www.youtube.com/watch?v=h0s8CWpIKdg">Death by 3,000 Timers: Streaming Video-on-Demand for Cable TV</a></strong>, <a href=https://twitter.com/chris_csguy>Chris Hines</a>, GopherCon 2019. Chris explains the mechanics behind the Go runtime scheduler, following the anomaly cases, they observed, when ran a Go application on a physical machine, with large number of CPU cores.</li><li><strong><a href="https://www.youtube.com/watch?v=5zXAHh5tJqQ">Rethinking Classical Concurrency Patterns</a></strong> (<a href=https://drive.google.com/file/d/1nPdvhB0PutEJzdCq5ms6UI58dp50fcAN/view>Slides</a>), <a href=https://github.com/bcmills>Bryan C. Mills</a>, GopherCon 2018. Brian demos the implementation of typical concurrency patterns, following the famous Go proverb: &ldquo;Don&rsquo;t communicate by sharing memory; share memory by communicating.&rdquo;</li><li><strong><a href="https://www.youtube.com/watch?v=ZfdF8gPinlU">GoLab Keynote</a></strong>, <a href=https://twitter.com/goinggodotnet>Bill Kennedy</a>, GoLab 2018. Bill demoes the ways to reason about the performance of a Go application, with the help of Go runtime tracer.</li><li><strong><a href="https://www.youtube.com/watch?v=YHRO5WQGh0k">The Scheduler Saga</a></strong>, Kavya Joshi, GopherCon 2018. Kavya shows what stands behind the magic of Go runtime.</li><li><strong><a href="https://www.youtube.com/watch?v=1v3RilVOTKM">Restarting Go applications gracefully</a></strong> (<em>in Russian</em>), <a href=https://sergey.kamardin.org/>Сергей Камардин</a>, GopherCon Russia 2018</li><li><strong><a href="https://www.youtube.com/watch?v=8hQG7QlcLBk">Advanced Testing with Go</a></strong>, <a href=https://twitter.com/mitchellh>Mitchell Hashimoto</a>, GopherCon 2017</li><li><strong><a href="https://www.youtube.com/watch?v=KBZlN0izeiY">Understanding Channels</a></strong>, Kavya Joshi, GopherCon 2017. Kavya explains how channels work under the hood.</li></ul><p>Keeping the list here, in public, should help my future self, in a situation where I&rsquo;m stuck with a <em>mind-blocker</em>, and I need to quickly pull out a piece of community wisdom from the backyards of my memory. The list isn&rsquo;t meant to be complete, and I expect to add more links here, moving forward.</p><p><em>Did I miss any? Share your suggestions with me on <a href=https://twitter.com/tvii/status/1491136758792155139>Twitter</a>.</em></p><footer class=meta><time datetime=2022-02-08T12:00:00Z>February 8, 2022</time><a class=tag href=/notes/bookmarks/>Bookmarks</a><a class=tag href=/notes/go/>Go</a></footer></article><article class=article data-weight=0 data-word-count=100 data-reading-time=1><header class=section-head><h2><a href=/notes/2022/02/love-hate-material/>Love. Hate. Material Design</a></h2></header><p>If Chrome had a notch</p><figure><img src=/images/2022/material-chrome-cut-1x.jpg alt="Chrome notch" width=1000></figure><p><a href=/notes/2022/02/love-hate-material/>Another witty picture under the cut…</a></p><footer class=meta><time datetime=2022-02-02T12:00:00Z>February 2, 2022</time><a class=tag href=/notes/material-design/>Material Design</a><a class=tag href=/notes/random/>Random</a></footer></article><article class=article data-weight=0 data-word-count=1500 data-reading-time=7><header class=section-head><h2><a href=/notes/2022/01/i-got-covid/>I've got COVID. What do I do next?</a></h2></header><p>Go to <a href=https://www.berlin.de/corona/massnahmen/abstands-und-hygieneregeln/>https://www.berlin.de/corona/massnahmen/abstands-und-hygieneregeln/</a> for the information (in German) about the latest regulations in Berlin. For the up-to-date information in your region, consult with your local authorities.</p><p><em>Everything I list below are the steps I found relevant, after I&rsquo;ve self-tested positive for COVID in Berlin, in the end of January 2022</em>.</p><h3 id=friday-28th-january-2022>Friday, 28th January 2022</h3><p>I woke up with some <em>mild</em> symptoms of cold. On the day before I worked from home, and only had a usual an hour-long walk around Prenzlauer Berg — Mitte after the workday. The rapid antigen test (<em>Schnelltest</em>) was negative.</p><p>While still working from home, I took a &ldquo;quiet Friday&rdquo; at work, to simply focused on some mundane routines.</p><p>I went for a short walk in the afternoon, bought some grocery, and headed home.</p><h3 id=saturday-29th-january>Saturday, 29th January</h3><p>Didn&rsquo;t feel anywhere better or worse: mostly had a runny nose and a dry throat. I didn&rsquo;t want to wait in the line for a quick-test, so I&rsquo;ve just walked around the city for an hour and went home.</p><h3 id=sunday-30th-january>Sunday, 30th January</h3><p>It felt the same as it&rsquo;d been the day before, although the dry throat started to feel a bit more intense. Walked around for an hour, came home, made some coffee ;)</p><p>A couple hours later I started to cough. I made a self-test — we still had some at home — and,</p><blockquote><p><em>Here we are! Welcome to the &ldquo;two-stripes&rdquo; club</em>.</p></blockquote><p><a href=/notes/2022/01/i-got-covid/>Keep reading…</a></p><footer class=meta><time datetime=2022-01-31T12:00:00Z>January 31, 2022</time><a class=tag href=/notes/berlin/>Berlin</a><a class=tag href=/notes/covid-19/>COVID-19</a></footer></article><article class=article data-weight=0 data-word-count=200 data-reading-time=1><header class=section-head><h2><a href=/notes/2021/12/error-messages-in-go/>Error messages in Go</a></h2></header><p>When Go code propagates an error, the following pattern is very popular:</p><pre tabindex=0><code>fmt.Errorf(&#34;failed to find a parking slot: %w&#34;, err)
// Or
fmt.Errorf(&#34;could not call mom: %w&#34;, err)
</code></pre><p>These &ldquo;could not&rdquo;, &ldquo;failed to&rdquo;, &ldquo;unable to&rdquo; make sense when my mind is in the local context of the function, method or package. But, in most of the cases I have to deal with, it makes the resulting log message overloaded with informational garbage:</p><pre tabindex=0><code>unable to ask about the cat: failed to call mom: failed to do request: Get https://: context canceled
</code></pre><p>While discussing this issue with a colleague, we came up with the following &ldquo;better&rdquo; strategy:</p><ol><li>only the logger should express its attitude to the facts, using words &ldquo;error&rdquo;, &ldquo;failed&rdquo;, etc</li><li>the business code must operate only with facts, e.g. &ldquo;call mom&rdquo;.</li></ol><pre tabindex=0><code>err := CallMom(number)
if err != nil {
    return fmt.Errorf(&#34;call mom (tel %s): %w&#34;, number, err)
}
</code></pre><p>This renders as following to the application logs:</p><pre tabindex=0><code>error: ask about cat: call mom (tel 123): make request: Get https://: context canceled
</code></pre><p>For a long stack of errors, this makes the full error message more dense, showing more useful information per line.</p><footer class=meta><time datetime=2021-12-30T12:00:00Z>December 30, 2021</time><a class=tag href=/notes/go/>Go</a></footer></article><article class=article data-weight=0 data-word-count=400 data-reading-time=2><header class=section-head><h2><a href=/notes/2021/10/good-coffee-places-in-berlin/>Good coffee places in Berlin</a></h2></header><p>My definition of &ldquo;good coffee places&rdquo; includes, although, by no mean limited by, offering a &ldquo;not too fruity&rdquo; filter coffee or a decent americano.</p><p><a href=/notes/2021/10/good-coffee-places-in-berlin/>Keep reading…</a></p><footer class=meta><time datetime=2021-10-10T12:00:00Z>October 10, 2021</time><a class=tag href=/notes/berlin/>Berlin</a><a class=tag href=/notes/coffee/>Coffee</a></footer></article><article class=article data-weight=0 data-word-count=800 data-reading-time=4><header class=section-head><h2><a href=/notes/2021/09/making-sense-of-requests-for-cpu-resources-in-kubernetes/>Making sense of requests for CPU resources in Kubernetes</a></h2></header><p>Kubernetes allows a container to request several resource types:</p><pre tabindex=0><code>apiVersion: v1
kind: Pod
metadata:
  name: my-app
spec:
  containers:
  - name: my-app
    image: images.example/my-app
    resources:
      requests:
        cpu: &#34;100m&#34;
        memory: &#34;64Mi&#34;
      limits:
        cpu: &#34;500m&#34;
        memory: &#34;128Mi&#34;
</code></pre><p>One particularly confusing type of the resource for me was <code>cpu</code>. For example, in the manifest above, the <code>my-app</code> container declares a request for &ldquo;100m&rdquo; of the CPU. What does that mean?</p><p><a href=/notes/2021/09/making-sense-of-requests-for-cpu-resources-in-kubernetes/>Keep reading…</a></p><footer class=meta><time datetime=2021-09-26T12:00:00Z>September 26, 2021</time><a class=tag href=/notes/kubernetes/>Kubernetes</a><a class=tag href=/notes/docker/>Docker</a></footer></article><article class=article data-weight=0 data-word-count=500 data-reading-time=2><header class=section-head><h2><a href=/notes/2021/08/one-step-closer-to-tabless-workflow/>One step closer to "Tabless" workflow</a></h2></header><p>Many years ago I embraced &ldquo;tabless&rdquo; development workflow: I use buffers, when I&rsquo;m in Vim; I also switch tabs off in both Goland and VS Code, as the first thing after I install the IDEs to a new laptop.</p><p>I&rsquo;m trying the same with Firefox web-browser now:</p><figure><img src=/images/2021/firefox-91-2021-a.jpg alt="Tabless Firefox 91" width=1100></figure><ol><li><p>Enable <code>toolkit.legacyUserProfileCustomizations.stylesheets</code> switch in Firefox&rsquo;s config (via <code>about:config</code> page or inside <code>user.js</code>).</p></li><li><p>Place the styles below into <code>%PROFILE%/chrome/userChrome.css</code> (I pick the actual path to the profile directory from Firefox&rsquo;s <code>about:support</code> page).</p></li></ol><pre tabindex=0><code>// Hide the tabs.
// Beware that hidding the tabs with &#34;display: none&#34; will ruine you browser&#39;s recent history,
// I&#39;ve learned that in a hard way ;)
#TabsToolbar &gt; .toolbar-items {
    opacity: 0;
    pointer-events: none;
}

// Pull the navigation bar up, on top of the empty space, that left after we&#39;d hidden the tabs.
#nav-bar {
    margin-top: calc((7px + var(--tab-min-height)) * -1);
}

// On macOS, when not in full screen, shift the urlbar&#39;s panel to the right,
// after close-minimise-expand buttons.
:root:not([inFullscreen]) #nav-bar-customization-target {
    margin-left: 65px;
}
</code></pre><p>I looked at <a href=https://searchfox.org/mozilla-central/source/browser/base/content>mozilla-central/··/navigator-toolbox.inc.xhtml</a> to get the structure of Firefox&rsquo;s UI.</p><ol start=3><li><p>Pick some nice and clean theme. My kudos to <a href=https://addons.mozilla.org/en-GB/firefox/addon/safari-macos-monterey-light/>Safari - MacOS Monterey Light</a> by a person nicknamed <a href=https://addons.mozilla.org/en-GB/firefox/user/16761237/>notcat</a>.</p></li><li><p>(<em>Optional</em>) In Firefox&rsquo;s &ldquo;General&rdquo; preferences, switch off &ldquo;Ctrl+Tab circles through tabs&rdquo;. With that, pressing Ctrl+Tab exposes all currently open pages (similar to how on macOS or other OS one switches between the opened applications with ⌘+Tab).</p></li></ol><hr><p>Overall I&rsquo;m fairly happy with how it ended up. Although, some things aren&rsquo;t quite ideal yet (might add more as I use this setup):</p><p>I wish there was a shortkey to enter a &ldquo;modal mode&rdquo;, where I could filter the list of open pages, to search for a particular page, and to switch to this page. Something similar to <code>:ls</code> command in Vim, or ⌘+E in Goland. I can use Firefox&rsquo;s &ldquo;Search amongst Tabs&rdquo; for that (press ⌘+L to focus into the URL bar, and querying with &ldquo;%[space]&rdquo;) but that requires some getting used to.</p><p>Firefox has &ldquo;Show all tabs&rdquo; button (Ctrl+Shift+Tab) but the way it works, at least in Firefox 91, is very confusing and random. It seems to me, its behaviour is tightly coupled to the browser&rsquo;s Tab UI.</p><p><strong>Update (2022-12-16)</strong> I&rsquo;ve found <a href=https://addons.mozilla.org/en-GB/firefox/addon/panorama-tab-groups/>Panorama Tab Groups</a> extension, which exposes the opened pages, and it works pretty well for me. One very minor thing is that I have to use Cmd+Shift+E because Cmd+E is locked in Firefox.</p><footer class=meta><time datetime=2021-08-23T12:00:00Z>August 23, 2021</time><a class=tag href=/notes/design/>Design</a><a class=tag href=/notes/firefox/>Firefox</a></footer></article><article class=article data-weight=0 data-word-count=500 data-reading-time=3><header class=section-head><h2><a href=/notes/2021/07/self-signed-certificates-with-k3s-and-cert-manager/>Self-signed certificates with k3s and cert-manager</a></h2></header><p>At least for now, my homelab cluster (<a href=/notes/2020/01/raspi-ubuntu-arm64-k3s/>4x Raspberry Pi, k3s, etc</a>) is available only for the devices <a href=/notes/2021/04/wireless-to-ethernet-island-for-homelab-cluster-ipv6-ndp-proxy-and-mdns-reflector/>on my local network</a>, inside a custom DNS zone <code>k8s.pi.home</code>. I don&rsquo;t think there are practical reasons to run anything with HTTPS in that setup, but there are cases, like browser extensions, where it&rsquo;s required.</p><p>Turned out, in 2021, it&rsquo;s fairly straight forward to set up a Certificate Authority (CA), that will issue TLS certificates to &ldquo;secure&rdquo; the ingress resources. At least, it&rsquo;s way simpler comparing to how I remember it was back in the days. All thanks to <a href=https://cert-manager.io>cert-manager</a> and some YAML.</p><p>First thing is to install cert-manager to the cluster. <a href=https://rancher.com/docs/k3s/latest/en/helm/>k3s comes with helm-controller</a>, that gives us a way to manage helm charts with Custom Resource Definitions (CRD). The following manifest defines a new namespace, and a resource of a kind <code>HelmChart</code>, to install cert-manager inside this namespace:</p><pre tabindex=0><code>apiVersion: v1
kind: Namespace
metadata:
  name: cert-manager

---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: cert-manager
  namespace: kube-system
spec:
  chart: cert-manager
  repo: https://charts.jetstack.io
  targetNamespace: cert-manager
  valuesContent: |-
    installCRDs: true
    prometheus:
      enabled: true
      servicemonitor:
        enabled: true
</code></pre><p>After applying the manifest above — <code>kubectl apply -f cert-manager.yml</code> — define a self-signed certificate, which is used to bootstrap a CA:</p><pre tabindex=0><code>apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned-cluster-issuer
spec:
  selfSigned: {}

---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: selfsigned-ca
spec:
  isCA: true
  commonName: selfsigned-ca
  secretName: selfsigned-ca-root-secret
  privateKey:
    algorithm: ECDSA
    size: 256
  issuerRef:
    name: selfsigned-cluster-issuer
    kind: ClusterIssuer
    group: cert-manager.io

---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: selfsigned-issuer
spec:
  ca:
    secretName: selfsigned-ca-root-secret
</code></pre><p>And now, I can use <code>selfsigned-issuer</code> to issue TLS certificates for the ingress resources (<em>Traefik ingress in the k3s&rsquo;s case</em>). E.g. to play around, I run an open-source version of <a href=https://languagetool.org/dev>LanguageTool</a> server. The ingress manifests for the server looks like as following:</p><pre tabindex=0><code>apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: languagetool-server
  annotations:
    kubernetes.io/ingress.class: traefik
    cert-manager.io/issuer: selfsigned-issuer
spec:
  rules:
  - host: languagetool.k8s.pi.home
    http:
      paths:
      - path: /
        pathType: ImplementationSpecific
        backend:
          service:
            name: languagetool-server
            port:
              number: 8010
  tls:
  - hosts: [languagetool.k8s.pi.home]
    secretName: languagetool-server-cert
</code></pre><p>Of course, any certificate signed by my CA won&rsquo;t be automatically trusted by anyone, including my own system. If I try to access <code>https://languagetool.k8s.pi.home</code>, any HTTP client will raise a &ldquo;failed to verify the legitimacy of the server&rdquo; issue. I don&rsquo;t know if there is a better way to solve that, but I can hack that around by installing the cluster&rsquo;s root CA certificate into the system&rsquo;s keychain, and telling the system, that it should &ldquo;trust&rdquo; the certificate:</p><pre tabindex=0><code>$ kubectl get secret/selfsigned-ca-root-secret -o json \
  | jq -r &#39;.data[&#34;ca.crt&#34;]&#39; \
  | base64 -D &gt; ~/tmp/selfsigned-root-ca.crt
$ open ~/tmp/selfsigned-root-ca.crt
</code></pre><p>Choose &ldquo;Always trust&rdquo; the certificate in the keychain&rsquo;s certificate settings. The server looks <em>legitimate</em> now!</p><footer class=meta><time datetime=2021-07-10T12:00:00Z>July 10, 2021</time><a class=tag href=/notes/homelab/>Homelab</a><a class=tag href=/notes/raspberry-pi/>Raspberry Pi</a><a class=tag href=/notes/k3s/>K3s</a></footer></article><article class=article data-weight=0 data-word-count=1600 data-reading-time=8><header class=section-head><h2><a href=/notes/2021/04/wireless-to-ethernet-island-for-homelab-cluster-ipv6-ndp-proxy-and-mdns-reflector/>Wireless-to-Ethernet island for homelab cluster: IPv6, NDP proxy and mDNS reflector</a></h2></header><p>Initially, when I assembled <a href=/notes/2020/01/raspi-ubuntu-arm64-k3s/>a homelab cluster of Raspberry Pis</a>, everything was directly connected to my Wi-Fi router with the Ethernet cables. This worked fine but this &ldquo;stack of boards&rdquo; behind the sofa in the centre of our small flat bugged me a bit.</p><p>Last year I decided to reorganise the cluster, turning it into a <em>wireless-to-wired island</em>, which I could relocate anywhere within the flat, without doing any special cable management, while staying cheap and avoid stacking the appartment with even more gadgets. After going through a number of trials and errors, the final setup looks as the following:</p><figure><img src=/images/2021/homelab-pi-net-1.png alt="Homelab cluster as a wireless-to-ethernet island (2021)" width=820></figure><p>Different colours contour the connections between two logical subnets — more on that later. Here what we have on the schema (top to bottom):</p><p><a href=/notes/2021/04/wireless-to-ethernet-island-for-homelab-cluster-ipv6-ndp-proxy-and-mdns-reflector/>Keep reading…</a></p><footer class=meta><time datetime=2021-04-26T12:00:00Z>April 26, 2021</time><a class=tag href=/notes/homelab/>Homelab</a><a class=tag href=/notes/raspberry-pi/>Raspberry Pi</a><a class=tag href=/notes/ipv6/>IPv6</a><a class=tag href=/notes/mdns/>MDNS</a><a class=tag href=/notes/ndppd/>Ndppd</a></footer></article><article class=article data-weight=0 data-word-count=100 data-reading-time=1><header class=section-head><h2><a href=/notes/2021/04/development-environment-in-2020/>Development environment in 2020</a></h2></header><figure><img src=/images/2021/state-of-dev-2020-1.png alt="Development environment in 2020" width=600></figure><p><em>Last year I made this one, after involving myself into <a href=https://twitter.com/tvii/status/1343243854183604226>a very random discussion on Twitter</a>, about the unnecessary complexity and none-sense of modern days&rsquo; development environments.</em></p><footer class=meta><time datetime=2021-04-05T12:00:00Z>April 5, 2021</time><a class=tag href=/notes/random/>Random</a></footer></article><nav class=pagination><a class=page-item href=/notes/ aria-label="Page 1">1</a>
<span class="page-item page-item-active" aria-current=page aria-label="Page 2">2</span>
<a class=page-item href=/notes/page/3/ aria-label="Page 3">3</a>
<a class=page-item href=/notes/page/4/ aria-label="Page 4">4</a></nav></main><footer class=site-footer>#НетВойне<br><a href=mailto:vladimir@varank.in>vladimir@varank.in</a></footer><img src=https://c.varank.in/hello/*https://vladimir.varank.in/notes/ style=position:absolute;left:-9999px decoding=async alt></body></html>