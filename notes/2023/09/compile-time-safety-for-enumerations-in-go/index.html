<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Compile-time safety for enumerations in Go - Vladimir Varankin</title>
<link rel=canonical href=https://vladimir.varank.in/notes/2023/09/compile-time-safety-for-enumerations-in-go/><meta property="og:title" content="Compile-time safety for enumerations in Go"><meta property="og:description" content="Last month, a colleague of mine asked how to reason about enumerated values (&ldquo;enums&rdquo;) in Go. They wanted to benefit from Go&rsquo;s type-safety and to prevent users from misusing the package.
For an imaginary example, that enumerates possible colours, the snippet below shows how we typically implement this:
type Color string const ( Red Color = &#34;red&#34; Green Color = &#34;green&#34; Blue Color = &#34;blue&#34; ) But, just like Bill Kennedy illustrated it in the blog post on a similar topic, such implementation allows a user to pass any &ldquo;untyped constant string&rdquo; in places where the Color type is expected. Also, a user can declare their own value of a type Color, going beyond what was defined by the initial enumeration set.
package main func main() { PrintColor(color.Red) PrintColor(&#34;RAINBOW&#34;) var rainbow color.Color = &#34;🌈&#34; PrintColor(rainbow) } func PrintColor(c color.Color) { fmt.Printf(&#34;%v\n&#34;, c) } // Outputs: red RAINBOW 🌈 Note how in the snippet above, the user both called PrintColor(“RAINBOW”) and defined their own variable of type color.Color, which holds a random string.
Update: a number of people pointed at my choice of words in the paragraph below, where I introduce a way to solve the problems. Indeed, &ldquo;elegant&rdquo; isn&rsquo;t the most accurate one to describe this solution :) Also, refer to #19412 for the discussion about adding sum types to Go.
Go&rsquo;s type system allows preventing both issues in a rather elegant way. Let&rsquo;s declare the Color interface, with an unexported method, while implementing this interface in an unexported type color:
package color type Color interface { xxxProtected() } type color string func (c color) xxxProtected() {} const ( Red color = &#34;red&#34; Green color = &#34;green&#34; Blue color = &#34;blue&#34; ) Because no types outside of our package color can implement the unexported method color.Color.xxxProtected(), we limit the possible implementations of the Color interface to only values, defined in the package color.
package main func main() { PrintColor(color.Red) //PrintColor(&#34;RAINBOW&#34;) // cannot use (constant of type string) as color.Color } func PrintColor(c color.Color) { fmt.Printf(&#34;%v\n&#34;, c) } If a user tries to pass an untyped constant string or declare their own variant of the colour, the code won&rsquo;t compile, resulting with an error:
package main type mycolor string func (c mycolor) xxxProtected() {} func main() { black := mycolor(&#34;BLACK&#34;) PrintColor(black) } OUTPUTS: ./prog.go:9:13: cannot use black (variable of type mycolor) as color.Color value in argument to PrintColor: mycolor does not implement color.Color (missing method xxxProtected) Have you stumbled upon a scenario, where such strict compile-time checks for enumerated values was needed? Share your thoughts with me on Hacker News, Twitter or Bluesky."><meta property="og:type" content="article"><meta property="og:url" content="https://vladimir.varank.in/notes/2023/09/compile-time-safety-for-enumerations-in-go/"><meta property="article:section" content="notes"><meta property="article:published_time" content="2023-09-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-29T00:00:00+00:00"><style>:root{--background-color:#fff;--text-color:rgb(19, 19, 19);--text-underline-color:rgba(19, 19, 19, 0.5);--header-color:#111;--hr-color:rgb(143, 150, 163);--link-color:rgb(0, 16, 161);--link-underline-color:rgba(0, 16, 161, 0.3);--link-active-color:rgb(231, 19, 19);--link-active-underline-color:rgba(231, 19, 19, 0.7);--tag-color:rgb(85, 63, 63);--tag-underline-color:rgba(85, 63, 63, 0.5)}html{font-size:16px;height:100%;margin:0;padding:0}body{background:var(--background-color);color:var(--text-color);display:grid;grid-template-rows:auto 1fr auto;font-family:Charter,Georgia,serif;font-size:1.1rem;line-height:1.3;margin:5px 1%;margin:5px max(7px,1%);margin:5px clamp(7px,1.5vw,14px);min-height:calc(100vh - 10px)}h1,h2,h3,h4,h5,h6{color:var(--header-color);font-family:Athelas,Georgia,serif;line-height:1;margin:1.5em 0 .7em}h1{font-size:40px;margin:.5em 0 .2em}a{color:#0010a1;color:var(--link-color);text-decoration-color:var(--link-underline-color);text-decoration-thickness:.04em;text-underline-offset:.1em}a:hover,a:active{color:#be0000;color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}ul,ol{box-sizing:border-box;max-width:760px;padding:0}ol{padding-left:1.2em}ul>li{list-style:none;margin:.5em 0}figure{margin:0;margin-block-start:1em;margin-block-end:1em;padding:0}figcaption{font-size:16px;font-style:italic}pre{line-height:1.1}code{font-family:sf mono,Menlo,Consolas,monospace;font-size:16px}pre code{font-size:14px;tab-size:2}@media screen and (min-device-width:900px){pre{margin:2em 1em}pre code{font-size:15px;tab-size:4}}hr{color:var(--hr-color);border:none;margin:.5em 0;width:90%}hr::after{content:'¶';display:block;font-size:14px;text-align:center}.site-nav{display:flex;flex-wrap:wrap;letter-spacing:.3em;padding-bottom:16px}.site-nav a,.site-nav span{margin-right:.6em;letter-spacing:0}.site-nav-item-active{color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}.site-content{font-size:19px;max-width:940px}.site-content img{max-width:100%;max-width:calc(100vw - 15px)}.site-content pre{max-width:calc(100vw - 1em);overflow:visible;overflow-x:scroll}@media screen and (min-width:900px){.site-content pre{max-width:calc(100vw - 4em);overflow-x:visible}}.site-footer{font-size:14px;margin:50px 0 0}.site-footer a{color:var(--text-color);text-decoration-color:inherit;text-decoration-color:var(--text-underline-color)}.main-head{display:flex;align-items:baseline;gap:8px}.main-head-meta{font-size:16px;margin:0;padding:0}.main-head-meta a{color:var(--text-color);text-decoration-color:inherit;text-decoration-color:var(--text-underline-color);margin:0 5px 0 0}.main-head-meta a:hover,.main-head-meta a:active{color:var(--link-active-color);text-decoration-color:var(--link-active-underline-color)}.article{margin:0 0 50px}.article:last-child{margin-bottom:0}.section-head{font-size:28px}.section-head h1,.section-head h2{font-size:1em;margin-top:1em}.section-head h2{margin-bottom:0}.snippet{margin:0 0 40px}.snippet:last-of-type{margin:0}.snippet p{margin:0 0 .3em}.snippet-head h2{font-size:21px;margin:1em 0 .2em}.meta{font-size:14px;line-height:1;padding:5px 0 0}.tag{color:var(--tag-color);text-decoration-color:var(--tag-underline-color);margin:0 0 0 7px;text-transform:lowercase}.meta-topics-list{line-height:1.4;padding:34px 0 0}.meta-topics-list .tag{display:inline-block;margin:0 1ex 0 0}.pagination{display:flex;flex-wrap:nowrap}.page-item{display:inline-block;line-height:32px;margin-right:1em}.glitch:before{background:var(--background-color);position:absolute;content:attr(data-text);clip:rect(0,900px,0,0);animation:glitch-anim 2s infinite linear alternate-reverse;margin-left:-5px;text-shadow:1px 0 red}@media(prefers-reduced-motion){.glitch:before{display:none}}@keyframes glitch-anim{0%{clip:rect(3px,9999px,93px,0)}5%{clip:rect(53px,9999px,78px,0)}10%{clip:rect(10px,9999px,75px,0)}15%{clip:rect(32px,9999px,40px,0)}20%{clip:rect(65px,9999px,62px,0)}25%{clip:rect(31px,9999px,14px,0)}30%{clip:rect(94px,9999px,87px,0)}35%{clip:rect(81px,9999px,41px,0)}40%{clip:rect(45px,9999px,50px,0)}45%{clip:rect(82px,9999px,41px,0)}50%{clip:rect(71px,9999px,3px,0)}55%{clip:rect(75px,9999px,60px,0)}60%{clip:rect(20px,9999px,49px,0)}65%{clip:rect(67px,9999px,92px,0)}70%{clip:rect(47px,9999px,55px,0)}75%{clip:rect(63px,9999px,90px,0)}80%{clip:rect(70px,9999px,92px,0)}85%{clip:rect(41px,9999px,60px,0)}90%{clip:rect(56px,9999px,79px,0)}95%{clip:rect(21px,9999px,68px,0)}100%{clip:rect(15px,9999px,72px,0)}}</style></head><body><nav class=site-nav><a href=/ class=glitch data-text="Vladimir Varankin">Vladimir Varankin</a>
<a href=/notes/ class=site-nav-item-active>Notes</a>
<a href=/publications/>Publications</a>
<span>· </span><a href=https://github.com/narqo>GitHub</a>
<a href=https://bsky.app/profile/vladimir.varank.in title="Ask me for an invite code (5)">Bluesky</a>
<a href=https://twitter.com/tvii>Twitter</a>
<a href=https://t.me/varankinv>Telegram</a></nav><main class=site-content><header class=section-head><h1>Compile-time safety for enumerations in Go</h1></header><p>Last month, a colleague of mine asked how to reason about enumerated values (&ldquo;enums&rdquo;) in Go. They wanted to benefit from Go&rsquo;s type-safety and to prevent users from misusing the package.</p><p>For an imaginary example, that enumerates possible colours, the snippet below shows how we typically implement this:</p><pre tabindex=0><code>type Color string

const (
    Red   Color = &#34;red&#34;
    Green Color = &#34;green&#34;
    Blue  Color = &#34;blue&#34;
)
</code></pre><p>But, just like <a href=https://twitter.com/goinggodotnet/>Bill Kennedy</a> illustrated it in the <a href=https://www.ardanlabs.com/blog/2023/09/implementing-enumerations-in-golang.html>blog post on a similar topic</a>, such implementation allows a user to pass any &ldquo;<a href=https://go.dev/blog/constants#string-constants>untyped constant string</a>&rdquo; in places where the <code>Color</code> type is expected. Also, a user can declare their own value of a type <code>Color</code>, going beyond what was defined by the initial enumeration set.</p><pre tabindex=0><code>package main

func main() {
    PrintColor(color.Red)

    PrintColor(&#34;RAINBOW&#34;)

    var rainbow color.Color = &#34;🌈&#34;
    PrintColor(rainbow)
}

func PrintColor(c color.Color) {
    fmt.Printf(&#34;%v\n&#34;, c)
}

// Outputs:
red
RAINBOW
🌈
</code></pre><p>Note how in the snippet above, the user both called <code>PrintColor(“RAINBOW”)</code> and defined their own variable of type <code>color.Color</code>, which holds a random string.</p><p><em>Update: a number of people pointed at my choice of words in the paragraph below, where I introduce a way to solve the problems. Indeed, &ldquo;elegant&rdquo; isn&rsquo;t the most accurate one to describe this solution :) Also, refer to <a href=https://go.dev/issues/19412>#19412</a> for the discussion about adding sum types to Go.</em></p><hr><p>Go&rsquo;s type system allows preventing both issues <del>in a rather elegant way</del>. Let&rsquo;s declare the <code>Color</code> interface, with an <em>unexported method</em>, while implementing this interface in an unexported type <code>color</code>:</p><pre tabindex=0><code>package color

type Color interface {
    xxxProtected()
}

type color string

func (c color) xxxProtected() {}

const (
	Red   color = &#34;red&#34;
	Green color = &#34;green&#34;
	Blue  color = &#34;blue&#34;
)
</code></pre><p>Because no types outside of our package <code>color</code> can implement the unexported method <code>color.Color.xxxProtected()</code>, we limit the possible implementations of the <code>Color</code> interface to only values, defined in the package <code>color</code>.</p><pre tabindex=0><code>package main

func main() {
    PrintColor(color.Red)

    //PrintColor(&#34;RAINBOW&#34;) // cannot use (constant of type string) as color.Color
}

func PrintColor(c color.Color) {
    fmt.Printf(&#34;%v\n&#34;, c)
}
</code></pre><p>If a user tries to pass an untyped constant string or declare their own variant of the colour, the code won&rsquo;t compile, resulting with an error:</p><pre tabindex=0><code>package main

type mycolor string

func (c mycolor) xxxProtected() {}

func main() {
    black := mycolor(&#34;BLACK&#34;)
    PrintColor(black)
}

OUTPUTS:
./prog.go:9:13: cannot use black (variable of type mycolor) as color.Color value in argument to PrintColor:
mycolor does not implement color.Color (missing method xxxProtected)
</code></pre><p><em>Have you stumbled upon a scenario, where such strict compile-time checks for enumerated values was needed? Share your thoughts with me on <a href="https://news.ycombinator.com/item?id=37703175">Hacker News</a>, <a href=https://twitter.com/tvii/status/1707736145524600838>Twitter</a> or <a href=https://bsky.app/profile/vladimir.varank.in/post/3kajuu4lrn52b>Bluesky</a>.</em></p><footer class=meta><time datetime=2023-09-29T12:00:00Z>September 29, 2023</time><a class=tag href=/notes/go/>Go</a><a class=tag href=/notes/enum/>enum</a></footer><section class="meta meta-topics-list"><header class=meta-topics-list-title><h3>All topics</h3></header><a class=tag href=https://vladimir.varank.in/notes/apple/>apple</a><a class=tag href=https://vladimir.varank.in/notes/arduino/>arduino</a><a class=tag href=https://vladimir.varank.in/notes/arm64/>arm64</a><a class=tag href=https://vladimir.varank.in/notes/askme/>askme</a><a class=tag href=https://vladimir.varank.in/notes/aws/>aws</a><a class=tag href=https://vladimir.varank.in/notes/berlin/>berlin</a><a class=tag href=https://vladimir.varank.in/notes/bookmarks/>bookmarks</a><a class=tag href=https://vladimir.varank.in/notes/buildkit/>buildkit</a><a class=tag href=https://vladimir.varank.in/notes/cgo/>cgo</a><a class=tag href=https://vladimir.varank.in/notes/coffee/>coffee</a><a class=tag href=https://vladimir.varank.in/notes/continuous-profiling/>continuous profiling</a><a class=tag href=https://vladimir.varank.in/notes/covid-19/>COVID-19</a><a class=tag href=https://vladimir.varank.in/notes/design/>design</a><a class=tag href=https://vladimir.varank.in/notes/docker/>docker</a><a class=tag href=https://vladimir.varank.in/notes/dynamodb/>dynamodb</a><a class=tag href=https://vladimir.varank.in/notes/e-paper/>e-paper</a><a class=tag href=https://vladimir.varank.in/notes/english/>english</a><a class=tag href=https://vladimir.varank.in/notes/enum/>enum</a><a class=tag href=https://vladimir.varank.in/notes/esp8266/>esp8266</a><a class=tag href=https://vladimir.varank.in/notes/firefox/>firefox</a><a class=tag href=https://vladimir.varank.in/notes/github-actions/>github actions</a><a class=tag href=https://vladimir.varank.in/notes/go/>Go</a><a class=tag href=https://vladimir.varank.in/notes/google/>google</a><a class=tag href=https://vladimir.varank.in/notes/graphql/>graphql</a><a class=tag href=https://vladimir.varank.in/notes/homelab/>homelab</a><a class=tag href=https://vladimir.varank.in/notes/ipv6/>IPv6</a><a class=tag href=https://vladimir.varank.in/notes/k3s/>k3s</a><a class=tag href=https://vladimir.varank.in/notes/kubernetes/>kubernetes</a><a class=tag href=https://vladimir.varank.in/notes/linux/>linux</a><a class=tag href=https://vladimir.varank.in/notes/macos/>macos</a><a class=tag href=https://vladimir.varank.in/notes/material-design/>material design</a><a class=tag href=https://vladimir.varank.in/notes/mdns/>mDNS</a><a class=tag href=https://vladimir.varank.in/notes/music/>music</a><a class=tag href=https://vladimir.varank.in/notes/ndppd/>ndppd</a><a class=tag href=https://vladimir.varank.in/notes/neondatabase/>neondatabase</a><a class=tag href=https://vladimir.varank.in/notes/objective-c/>objective-c</a><a class=tag href=https://vladimir.varank.in/notes/passkeys/>passkeys</a><a class=tag href=https://vladimir.varank.in/notes/postgresql/>postgresql</a><a class=tag href=https://vladimir.varank.in/notes/pprof/>pprof</a><a class=tag href=https://vladimir.varank.in/notes/profefe/>profefe</a><a class=tag href=https://vladimir.varank.in/notes/random/>random</a><a class=tag href=https://vladimir.varank.in/notes/raspberry-pi/>raspberry pi</a><a class=tag href=https://vladimir.varank.in/notes/rust/>rust</a><a class=tag href=https://vladimir.varank.in/notes/travis-ci/>travis ci</a><a class=tag href=https://vladimir.varank.in/notes/vs-code/>vs code</a><a class=tag href=https://vladimir.varank.in/notes/waveshare/>waveshare</a><a class=tag href=https://vladimir.varank.in/notes/%C2%B5-benchmarks/>µ-benchmarks</a></section></main><footer class=site-footer>#НетВойне<br><a href=mailto:vladimir@varank.in>vladimir@varank.in</a></footer><img src=https://c.varank.in/hello/*https://vladimir.varank.in/notes/2023/09/compile-time-safety-for-enumerations-in-go/ style=position:absolute;left:-9999px decoding=async alt></body></html>