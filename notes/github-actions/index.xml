<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Github Actions on Vladimir Varankin</title><link>https://vladimir.varank.in/notes/github-actions/</link><description>Recent content in Github Actions on Vladimir Varankin</description><generator>Hugo</generator><language>en</language><lastBuildDate>Thu, 19 Sep 2019 00:00:00 +0000</lastBuildDate><atom:link href="https://vladimir.varank.in/notes/github-actions/index.xml" rel="self" type="application/rss+xml"/><item><title>Github Actions and GOPATH</title><link>https://vladimir.varank.in/notes/2019/09/github-actions-and-gopath/</link><pubDate>Thu, 19 Sep 2019 00:00:00 +0000</pubDate><guid>https://vladimir.varank.in/notes/2019/09/github-actions-and-gopath/</guid><description>&lt;p&gt;The other day I received my beta access to &lt;a href="https://github.com/features/actions"&gt;GitHub Actions&lt;/a&gt;. To try them out I picked an existing pet project and created a &lt;em&gt;workflow&lt;/em&gt; using a Go project template provided by GitHub. As it&amp;rsquo;s in &lt;em&gt;September 2019&lt;/em&gt;, their template defines the sequence of steps: setup Go, checkout code, get dependencies, build. This is not exactly how I used to do it.&lt;/p&gt;
&lt;p&gt;My project is a &lt;em&gt;classic Go service&lt;/em&gt; ;) meaning: it uses vendoring and doesn&amp;rsquo;t use Go modules. So no need for &amp;ldquo;get dependencies&amp;rdquo; step. And it requires to be inside the &lt;code&gt;GOPATH&lt;/code&gt;. With that, the provided workflow needed some adjustment.&lt;/p&gt;
&lt;p&gt;After some trials and errors, I&amp;rsquo;ve managed to make &lt;code&gt;checkout&lt;/code&gt; step to clone the repo into the correct destination inside the &lt;code&gt;GOPATH&lt;/code&gt;. Here is the final workflow:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;name: Run Go test
on: [pull_request]
jobs:
 test:
 strategy:
 matrix:
 go-version: [1.12.9]

 runs-on: ubuntu-latest

 steps:
 - uses: actions/setup-go@v1
 with:
 go-version: ${{ matrix.go-version }}

 - uses: actions/checkout@v1
 with:
 path: ./src/github.com/${{ github.repository }}
 fetch-depth: 5

 - run: make test
 env:
 GOPATH: ${{ runner.workspace }}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note, how &lt;code&gt;actions/checkout@v1&lt;/code&gt; above uses custom &lt;code&gt;path&lt;/code&gt; input parameter. I set the path to &lt;code&gt;./src/github.com/${{ github.repository }}&lt;/code&gt;, so the project is checked out to &lt;code&gt;src&lt;/code&gt; directory in the runners&amp;rsquo;s workspace, which I later pass as the value of &lt;code&gt;GOPATH&lt;/code&gt; to the &amp;ldquo;make test&amp;rdquo; step. The leading dot in &lt;code&gt;./src&lt;/code&gt; seems very important — I&amp;rsquo;ve spent the majority of the time trying to figure out that part — refer to &lt;a href="https://github.com/actions/checkout/issues/41"&gt;this issue&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/profefe/profefe/actions"&gt;See the workflow in action&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To learn more about those &lt;code&gt;${{ ··· }}&lt;/code&gt; &amp;ldquo;macroses&amp;rdquo; I suggest looking at the Actions&amp;rsquo; &amp;ldquo;&lt;a href="https://help.github.com/en/articles/contexts-and-expression-syntax-for-github-actions"&gt;Contexts and expression syntax&lt;/a&gt;&amp;rdquo; documentation.&lt;/p&gt;</description></item></channel></rss>